
<!-- $Id: index.html,v 1.6 2011-05-05 09:55:13 mh17 Exp $ -->

<h2>ZMap Design Documentation</h2>

<br />

<fieldset>
<legend>Pages Under Construction</legend>
<p>The documentation pages are being re-organised and updated. </p>
<p>Some old files are held in ZMap/web and will be moved into ZMap/doc on a gradual basis.  The ZMap/Web directory will be maintained during this process as some build scripts depend on it and as the files are in the CVS it provides a backup.  Some other files that have been deleted from ZMap/doc have been copied to ~mh17/zmap/doc.old and ~mh17/zmap/web.old until they get transferred to the new CVS directory tree.
</p>
<p>As files get added or copied or converted they will hopefully get added to this contents page, which is intended to be in alpha order. As the number of files increase then we'll add some nice &lt;div&gt;s to put them in pretty columns.
</p>
<h4>NOTE: broken links</h4>
<p>Due to a re-organisation and a directory rename many of the files contain broken links to the old directory.  The build script has been modifed to fix these, but it would be better to fix each link in the source html at some point,  Design_notes/ needs to be changed into Design/.
</p>
</fieldset>

<fieldset><legend>Contents</legend>
<div class="left">
<fieldset><legend>How it works</legend>
<a href="misc/about.html">About these pages</a><br />
<br />
<a href="notes/app_callbacks.html">Application Callbacks</a><br />
<a href="modules/zmapConfig.html">Configuration files</a>
<a href="modules/zmapApp.html">Sequence config</a><br />
<a href="modules/zmapWindowColBump.html">Column Bumping</a><br />
<a href="notes/coord_config.html">Coordinate systems and configuration</a><br />
<a href="notes/ContainerFeatureset.html">Container Featureset</a>
<a href="notes/FToIHash.html">FToIHash</a> <br />
<a href="modules/zmapFeature.html">Featuresets</a>
<a href="notes/featureset_col.html">Config</a>
<a href="notes/col_order.html">Column Ordering</a>
<br />
<a href="notes/feature_search.html">Features search</a>
<br />
<a href="notes/focus_list.html">Focus/ highlight items</a>
<br />


<a href="modules/zmapFeature.html">Featuresets and Styles</a>
<a href="notes/glyph_style.html">and Glyphs</a><br>
<a href="notes/view_window_style.html">Styles (Global)</a><br />
<a href="modules/pipeServer.html">pipeServer Config</a><br />
<a href="notes/slaveThread.html">Threads</a><br>
<a href="modules/zmapView.html">All about Views</a><br />
</fieldset>
</div>
<div  class="left">
<fieldset><legend>Requests and ideas</legend>
<a href="notes/EST_mRNA.html">Masking EST's with mRNA's</a><br />
<a href="notes/notepad.html">Feature Notepad</a><br />
<a href="notes/otter_zmap.html#otterface">Otterlace interface</a>
<a href="notes/otter_zmap.html#evidence">Show Evidence</a><br />
<a href="notes/RNAseq.html">RNAseq</a><br />
<a href="notes/BAM.html">BAM file data (short reads)</a><br />
<a href="notes/standalone.html">Standalone Operation</a><br />
<a href="notes/SQLite.html">SQLite configuration</a><br />
<a href="notes/data_config.html">Server &amp; featureset configuration</a><br />
<a href="notes/print.html">Screenshots</a><br />
<a href="notes/GFF_zmap.html">GFF (file) based Zmap</a><br />
<a href="notes/column_group.html">Column Groups</a><br />
<a href="notes/foo_coords.html">FooCanvas Loose Ends (Dec 2012)</a><br />
</fieldset>
</div>

<div class="left">
<fieldset><legend>Performance</legend>

<a href="notes/canvas_tweaks.html">Canvas Tweaks</a><br />
<a href="notes/new_model_canvas.html">New Model Canvas</a><br />
<a href="notes/density.html">Density Plots</a>
<a href="notes/graph_config.html">Config</a><br />
<a href="notes/sequenceFeature.html">SequenceFeature</a>
<a href="notes/LocusFeature.html">LocusFeature</a> <br />
<a href="notes/foo_perf.html">FooCanvas</a> <br />
<a href="notes/performance.html">Performance</a> <br />
<a href="notes/optimise.html">Optimising</a> <br />
<a href="notes/new_window.html">New Window</a> <br />
<a href="notes/containers.html">Containers</a> <a href="notes/canvasContainer.html">Post implementation</a> <br />
<a href="notes/refresh.html">Screen Refresh</a> <br />
</div>

<div class="left">
<fieldset><legend>User Docs</legend>
<a href="../user/zmap_quick_start.shtml">Running Zmap</a> <br />
<a href="../user/styles.shtml">Styles</a> <br />
<a href="../user/configuration.shtml">Config</a> <br />

</fieldset>
</div>
</fieldset>


<fieldset><legend>Unfinished Buisness</legend>
<p>
<ul>
<li>delayed server needs to free view_con->context etc etc (memory leak)
<li>sequence server is assumed to be ACEDB or some other server that is not delayed and there can be only one

<li><a href="modules/zmapView.html#DNA_memory">Scope and memory allocation issues</a> with DNA sequence data
<li>zMapFeaturesetCreateID() and zmapStyleCreateId() and ZMapGFFSet and ZMapGFFSource could benefit from a review.  (<b>NB</b> these structuire have been renamed ZMapFeatureSetDesc, ZMapFeatureSource The problem is that sometimes we want names normalised and sometimes we want them capitalised as given.  Perhaps the best way woule be to have all key values as normalised and duplicate quarks used for display names.  There are 86 calls to these functions, and this is not all the code that would have to be checked.
<li> Styles have <b>gff_source</b> and <b>gff_feature</b> parameters. There are supplied by ACEDB and only used for GFF dump functions.  This information is more appropriately handled by the GFFSource data structure, held in the view/window <b>context_map->source_2_sourcedata</b> hash table.

<li><b>zMapViewLoadFeatures()</b> is called for <b>OTF data requests</b> after the initial load, and featuresets etc are concatenated not merged. The server interface has some loose ends relating to whether or not the report all supported featuresets of just those requested, and currently theyeturn all styles not just those needed. Needs a tidy up.

<li>Locus features are apparently created via some kludge which causes some problems when deleting features. This and the naviagtor-sets needs a review. see eg <b>zmapViewRemoteRecieve.c #1601</b>.

<li>Migration from ACEDB requires featureset to column and style mappings which can be obscure. it is possible to extract this information by hand from otterlace config but this is not possible for users.
RC export/config could be used to dump this info to a file but due to scope issues it's really difficult to find that information where the functions get called from. This is tied up with view/window 'modularity' and there is a clear need to restructre some of the v iew and window data so that stuff that is needed by both modules is available. Currently some data (eg featureset_2_column) is copied but this is not ideal.

<li> <b>zMapFeatureGetColumnFeatureSets()</b> is very ineffcient in that it scans all the featuresets for each column.  An attempt to do this reverse mapping and stire the list int he column sturcture failed due to some obscure list corruption happening and was abandoned. Note also that user and unique ID's are needed.
With ext_curated we get and extra 1000 featuresets to scan for each column.

<li> zmapWindowContainerFeatureSet is created by three different versions of the same code: normal, navigator and separator and these should be merged and moved into zmapWindowContainerFeatureSet.c

<li> <a href="modules/zmapApp.html">sequence config</a>  needs to filter through the many layers of app, mamager, control, view, window as a <b>ZMapFeatureSequenceMap</b> rather than as many arguments. Thi is needed to allow extra information such as 'dataset' to be accessable.
</ul>
</p>


</fieldset>
<fieldset><legend>Things to fix</legend>
<p>
Here's a list of suspicious bits of code encountered while looking for something else
<ul>
<li><b>In zmpWindowCanvasItem.c zMapWindowCanvasItemGetBounds()</b> looks like a cut &amp; paste of <b>zMapWindowCanvasItemGetFeature()</b>  directly above it including the explanatory comment. It's not called from anywhere.
<li>zmapWindowFeatureShow.c appears to have some memory leaks - strings are strdup'd when creating a GUINotebook, but are they freed on Notebook destroy??
<li> feature search with a wildcard featureset tries all possible rather than all existing featuresets: not very efficient.
<li> window focus can crash on zmap shutdown due to a bad free (must be twice)
</ul>
</p>
</fieldset>
