
<!-- $Id: index.html,v 1.1 2011-01-11 16:05:50 mh17 Exp $ -->

<h2>ZMap Design Documentation</h2>

<br />

<fieldset>
<legend>Pages Under Construction</legend>
<p>The documentation pages are being re-organised and updated. </p>
<p>Some old files are held in ZMap/web and will be moved into ZMap/doc on a gradual basis.  The ZMap/Web directory will be maintained during this process as some build scripts depend on it and as the files are in the CVS it provides a backup.  Some other files that have been deleted from ZMap/doc have been copied to ~mh17/zmap/doc.old and ~mh17/zmap/web.old until they get transferred to the new CVS directory tree.
</p>
<p>As files get added or copied or converted they will hopefully get added to this index page, which is intended to be in alpha order. As the number of files increase then we'll add some nice &lt;div&gt;s to put them in pretty columns.
</p>
</fieldset>

<fieldset><legend>Contents</legend>
<div class="left">
<fieldset><legend>How it works</legend>
<a href="Design_notes/misc/about.shtml">About these pages</a><br />
<br />
<a href="Design_notes/modules/zmapConfig.shtml">Configuration files</a><br />
<a href="Design_notes/notes/coord_config.shtml">Coordinate systems and configuration</a><br />
<a href="Design_notes/notes/ContainerFeatureset.shtml">Container Featureset</a>
<a href="Design_notes/notes/FToIHash.shtml">FToIHash</a> <br />
<a href="Design_notes/modules/zmapFeature.shtml">Featuresets</a>
<a href="Design_notes/notes/featureset_col.shtml">Config</a>
<a href="Design_notes/notes/col_order.shtml">Column Ordering</a>
<br />
<a href="Design_notes/notes/feature_search.shtml">Features search</a>
<br />
<a href="Design_notes/notes/focus_list.shtml">Focus/ highlight items</a>
<br />


<a href="Design_notes/modules/zmapFeature.shtml">Featuresets and Styles</a>
<a href="Design_notes/notes/glyph_style.shtml">and Glyphs</a><br>
<a href="Design_notes/notes/view_window_style.shtml">Styles (Global)</a><br />
<a href="Design_notes/modules/pipeServer.shtml">pipeServer Config</a><br />
<a href="Design_notes/notes/slaveThread.shtml">Threads</a><br>
<a href="Design_notes/modules/zmapView.shtml">All about Views</a><br />
</fieldset>
</div>
<div  class="left">
<fieldset><legend>Requests and ideas</legend>
<a href="Design_notes/notes/EST_mRNA.shtml">Masking EST's with mRNA's</a><br />
<a href="Design_notes/notes/notepad.shtml">Feature Notepad</a><br />
<a href="Design_notes/notes/otter_zmap.shtml#otterface">Otterlace interface</a>
<a href="Design_notes/notes/otter_zmap.shtml#evidence">Show Evidence</a><br />
<a href="Design_notes/notes/RNAseq.shtml">RNAseq</a><br />
</fieldset>
</div>

<div class="left">
<fieldset><legend>Performance</legend>

<a href="Design_notes/notes/canvas_tweaks.shtml">Canvas Tweaks</a><br />
<a href="Design_notes/notes/density.shtml">Density Plots</a> <br />
<a href="Design_notes/notes/performance.shtml">Performance</a> <br />
<a href="Design_notes/notes/profile.shtml">Profiling</a> <br />
<a href="Design_notes/notes/optimise.shtml">Optimising</a> <br />


</fieldset>
</div>
</fieldset>


<fieldset><legend>Unfinished Buisness</legend>
<p>
<ul>
<li>delayed server needs to free view_con->context etc etc (memory leak)
<li>sequence server is assumed to be ACEDB or some other server that is not delayed and there can be only one

<li><a href="Design_notes/modules/zmapView.shtml#DNA_memory">Scope and memory allocation issues</a> with DNA sequence data
<li>zMapFeaturesetCreateID() and zmapStyleCreateId() and ZMapGFFSet and ZMapGFFSource could benefit from a review.  (<b>NB</b> these structuire have been renamed ZMapFeatureSetDesc, ZMapFeatureSource The problem is that sometimes we want names normalised and sometimes we want them capitalised as given.  Perhaps the best way woule be to have all key values as normalised and duplicate quarks used for display names.  There are 86 calls to these functions, and this is not all the code that would have to be checked.
<li> Styles have <b>gff_source</b> and <b>gff_feature</b> parameters. There are supplied by ACEDB and only used for GFF dump functions.  This information is more appropriately handled by the GFFSource data structure, held in the view/window <b>context_map->source_2_sourcedata</b> hash table.

<li><b>zMapViewLoadFeatures()</b> is called for <b>OTF data requests</b> after the initial load, and featuresets etc are concatenated not merged. The server interface has some loose ends relating to whether or not the report all supported featuresets of just those requested, and currently theyeturn all styles not just those needed. Needs a tidy up.

<li>Locus features are apparently created via some kludge which causes some problems when deleting features. This and the naviagtor-sets needs a review. see eg <b>zmapViewRemoteRecieve.c #1601</b>.

<li>Migration from ACEDB requires featureset to column and style mappings which can be obscure. it is possible to extract this information by hand from otterlace config but this is not possible for users.
RC export/config could be used to dump this info to a file but due to scope issues it's really difficult to find that information where the functions get called from. This is tied up with view/window 'modularity' and there is a clear need to restructre some of the v iew and window data so that stuff that is needed by both modules is available. Currently some data (eg featureset_2_column) is copied but this is not ideal.

<li> <b>zMapFeatureGetColumnFeatureSets()</b> is very ineffcient in that it scans all the featuresets for each column.  An attempt to do this reverse mapping and stire the list int he column sturcture failed due to some obscure list corruption happening and was abandoned. Note also that user and unique ID's are needed.
With ext_curated we get and extra 1000 featuresets to scan for each column.

<li> the columns dialog needs to feed off server config for loading columns

<li> request logic (for servers) is tangled up with aligns and blocks and the request coordinates are unknown. ACEDB appear to provide multiple aligns and block but pipe servers cannot - this logic need to be in the ZMap application and chromosome coordnates shoudl be supplied by ZMap - currently they are buried in pipe server config in a url.
<li> It would be better is ZMap used chromosome coordinates internally and if these are deemed 'too big' to present to the user (eg on the ruler) then they can be made relative to each block for display.

<li> zmapWindowContainerFeatureSet is created by three different versions of the same code: normal, navigator and separator and these should be merged and moved into zmapWindowContainerFeatureSet.c

<li> Initial and deferred load of features goes via different paths resulting in repeated coding
</ul>
</p>


</fieldset>
<fieldset><legend>Things to fix</legend>
<p>
Here's a list of suspicious bits of code encountered while looking for something else
<ul>
<li><b>In zmpWindowCanvasItem.c zMapWindowCanvasItemGetBounds()</b> looks like a cut &amp; paste of <b>zMapWindowCanvasItemGetFeature()</b>  directly above it including the explanatory comment. It's not called from anywhere.
<li>zmapWindowFeatureShow.c appears to have some memory leaks - strings are strdup'd when creating a GUINotebook, but are they freed on Notebook destroy??
<li> feature search with a wildcard featureset tries all possible rather than all existing featuresets: not very efficient.
<li> window focus can crash on zmap shutdown due to a bad free (must be twice)
</ul>
</p>
</fieldset>