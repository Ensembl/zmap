<h2>Column ordering</h2>
<fieldset><legend>Configuration</legend>
<p>Traditionally the list of columns to be displayed has been generated from the featuresets option in the sevrer stanza in the config file ZMap.
</p>

<p>with the advent of extra servers eg DAS, pipe, file this list has been generated by concatenating the lists of featuresets from each server, and there has been a choice of doing this either on startup (taking all dswervers defined in the 'sources' option in that order) or dynamically (adding to the list as data is received).
</p>

<p>Later versions of ZMap provide a columns option in the [ZMap] stanza which lists columns to display in order from left to right. It is also possible to map individual featuresets from several servers to a display colums via the [columns] stanza.
</p>
</fieldset>

<fieldset><legend>From configuration to actual display order</legend>
<p>Here we consider the default display with reverse strand on the left forward strand on the right and a separator in the middle.
<p>
The ZMap display is split into several sections and columns are included according to thier styles. These are:
<ul>
<li>strand-specific
<li>show-reverse-strand
<li>show-only-in-separator
<li>frame-mode
</ul>
The options define whether or not a column is  strand senesitive and/or frame senesitive and frame implies strand.
</p>

<p>
The '3 Frame' column is treated specially as a placeholder. Columns are grouped into three sections with frame sensitive colums in the middle (where 3 Frame appears in the list) and within each group columns are sorted into the order as defined in configuration.

</p>
<p>Features on the reverse strand are displayed to the left of the strand separator, but only if thier style specifies strand-specific.  Features that have styles that are not strand specific appear to the right of the strand seperator on either side of the 3 Frame section depending on where they appear in the columns list.  This implies that all data right of the 3 Frame section is not strand specific.
</p>
<p>
</fieldset>

<fieldset><legend>Reverse Complement and 3-Frame</legend>
<p>3 Frame mode will display frame sensitive colums in three groups, one for each frame, and these columns are sorted into configured order per group.  3Frame columns only appear on the right hand side of the display and contain features from the relevant strand ie normally the forward strand and the reverse strand if reverse complemented if the style used is strand specific, otherwise they may include both strands.
</p>
<p>GF-splice features are a special case as they are frame and strand sensitive and only include features from the forward strand.  It is meaningless to display this data for the reverse strand.
</p>
</fieldset>

<fieldset><legend>Implementation</legend>
<p>
All possible columns are created for featuresets when the arrive from various database servers via a few functions on <b>zmapWindow/zmapWindowDrawFeatures.c</b> that end up in <b>createColumnFull()</b>.
</p>
<p>
There is an execute function <b>windowDrawContextCB</b> that displays a feature context and calls
<b>set_name_create_set_columns()</b> at the block level to create columns per strand and <b>feature_set_matches_frame_drawing_mode()</b> at the featureset level to decide whether or not to include each one.
<i>Note that this second function also attempts to optimise the display of columns by preventing the drawing of columns that are already there.</i>.
</p>
<p><b>windowDrawContextCB()</b> is also called from <b>windowDrawContext()</b> for the normal display of features.
</p>
<p>Similar actions are taken by <b>zmapWindowDraw.c/zMapWindowToggle3Frame()</b> which calls <b>zmapWindowDrawFeatures.c/zmapWindowDraw3FrameFeatures()</b> and <b>zmapWindowDrawRemove3FrameFeatures()</b>.  Note that when turning off 3 Frame mode we may have to re-draw single columns for those features defined as 'always display'.
<b>purge_hide_frame_specific_columns()</b> handles removing unwanted columns for these types.
</p>


</fieldset>

<fieldset><legend>Implementation #2</legend>
<p><b>set_name_create_set_columns()</b> has been removed and columns are now created on demand.
</p>
<p>
The command [ZMap] columns= xxx; yyy ; etc is suppoed to specify which ciolums to display and in what order, but extra data requested from servers gets displayed regardless.  These extra columns are place top thr RHS of the display and ordered by featureset id - this is to ensure a stable/ predictable display.  Ideally they should be specified in the columns command.
</p>

</fieldset>