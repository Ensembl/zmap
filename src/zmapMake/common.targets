#
# common targets that all ZMap makefiles must include for our recursive make
# sytem to work.
#


#
# COMMON TARGETS
#
# These targets expect the various CURRENT_xxx macros they use to have been
# set, otherwise they just won't work... (for now we set CURRENT_AR automatically
# as this seems ok).
#

# note brackets so we get construct of:     libXXXX(nn.o yyy.o xxx.o)
CURRENT_AR = $(CURRENT_LIB)($(CURRENT_OBJ))

all : makebindir $(CURRENT_SRC) $(CURRENT_LIB)
	@echo "$(CURRENT_LIB) successfully made..."

#$(CURRENT_LIB) : $(CURRENT_AR)
$(CURRENT_LIB) : $(CURRENT_DEP) $(CURRENT_OBJ)

$(CURRENT_AR) : $(CURRENT_DEP) $(CURRENT_SRC)

$(CURRENT_SRC) : forcemake
	@$(TEST) -L $(BINDIR)/$@ || ln -s `pwd`/$@ $(BINDIR) 

clean :
	cd $(BINDIR) ; rm -f $(CURRENT_SRC)
	true ; $(CURRENT_REMOVE)
	$(AR) -d $(CURRENT_LIB) $(CURRENT_OBJ)
	@echo "$(CURRENT_OBJ) removed from $(CURRENT_LIB)"



# ok there is a bootstrapping problem here in that this makefile won't load unless
# the makedepend file is already there...so need to attend to that....
depend :
	@$(TEST) -w $(MAKEDEPEND_FILE) || chmod u+w $(MAKEDEPEND_FILE)
	makedepend -f$(MAKEDEPEND_FILE) -- $(CFLAGS) -- $(CURRENT_SRC) 

#

include $(MAKEDEPEND_FILE)

#
# include some targets needed by all levels of make.
#
include $(MAKE_DIR)/common.base_targets
