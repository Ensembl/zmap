#!/bin/bash
#
# Noddy script to run configure as alphas + Roys machine are far from standard.
#

root=`dirname $0`
script=`basename $0`

msgAndExit ()
{
  echo "Error: $1"
  exit 1
}


opsys=`uname`

case $opsys in

  OSF1 )
    locals=/nfs/team71/acedb/zmap/prefix/ALPHA/bin
    PATH="$locals:/usr/local/gtk2/bin:$PATH"
    export PATH

    # NOTE that currently the LDFLAGS stuff does not get through the configure step
    # and so does not work....not sure why....
    popt=/nfs/team71/acedb/zmap/prefix/ALPHA
    cc_args='CC=cc'

    # N.B. level5 messages just produces too much output for everyday use....
    cflags_args="CFLAGS=-I$popt/include -msg_enable level4"
    ld_args="LDFLAGS=-rpath /usr/local/gtk2/lib:$popt/lib"

    locals=/nfs/team71/acedb/zmap/prefix/ALPHA/lib/pkgconfig
    PKG_CONFIG_PATH="$locals:/usr/local/gtk2/lib/pkgconfig"
    export PKG_CONFIG_PATH ;;

  Linux )

    case `uname -m` in
      
      x86_64 )

         locals=~zmap/prefix/LINUX_64
         PATH="$locals/bin:$PATH"
         export PATH

         PKG_CONFIG_PATH="$locals/lib/pkgconfig"
         export PKG_CONFIG_PATH
         LD_LIBRARY_PATH="$locals/lib"
         export LD_LIBRARY_PATH

         cc_args='CFLAGS=-Wall'
         cflags_args=''
         # make sure zmap executable has path to foocanvas library.
         ld_args="LDFLAGS=-Xlinker -rpath -Xlinker $locals/lib" ;;

       * )

         locals=~zmap/prefix/LINUX
         PATH="$locals/bin:$PATH"
         export PATH

         PKG_CONFIG_PATH="$locals/lib/pkgconfig"
         export PKG_CONFIG_PATH
         LD_LIBRARY_PATH="$locals/lib"
         export LD_LIBRARY_PATH

         cc_args='CFLAGS=-Wall'
         cflags_args=''
         # make sure zmap executable has path to foocanvas library.
         ld_args="LDFLAGS=-Xlinker -rpath -Xlinker $locals/lib" ;;

    esac ;;

 Darwin )
    # SET PATH TO INCLUDE ~zmap/prefix && /sw/bin in that order
    # This is for autotools and pkg-config respectively
    # AceConn ... 
    # AceConn is installed in /sw/lib && /sw/include for now. A couple of things to note. (manual copy)
    # The AceConn-1.1.pc file is installed in /sw/lib/pkgconfig/ (manual copy)
    # The compile of AceConn using the make as setup didn't run ranlib!
    # Simply run ranlib /sw/lib/libAceConn.a && ranlib /sw/lib/libmd5.a
    # foocanvas is currently installed in below location...
    MAC_MOUNT_POINT=/Users/zmap/nfs_mount
    ZMAP_PREFIX=$MAC_MOUNT_POINT/prefix/MACOSX

    #PKG_CONFIG="pkg-config --define-variable=MOUNT_POINT=$MAC_MOUNT_POINT"
    PKG_CONFIG_PATH=$ZMAP_PREFIX/lib/pkgconfig:/usr/local/gtk2/lib/pkgconfig:/sw/lib/pkgconfig

    cc_args=""
    cflags_args="CFLAGS=-Wall -I$ZMAP_PREFIX/include"
    ld_args='LDFLAGS=-Xlinker -bind_at_load'
    LD_LIBRARY_PATH=$ZMAP_PREFIX/lib:$LD_LIBRARY_PATH

    #export PKG_CONFIG
    export PKG_CONFIG_PATH
    ;;
  * )
    msgAndExit "unsupported operating system: $opsys" ;;

esac

echo "$script : Running " $root/configure --enable-debug --enable-shtml-doc $cc_args "$cflags_args" "$ld_args" "$@"
echo "=========================================================================="


# run the configure.......watch out for the quoting, sometimes we want the variable to
# be interpreted as a single cmdline arg, sometimes as multiple ones.

$root/configure --enable-debug --enable-shtml-doc $cc_args "$cflags_args" "$ld_args" "$@" || msgAndExit "configure script failed"


exit 0

